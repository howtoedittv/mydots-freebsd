#!/usr/bin/env bash
#
# mkconfig â€” universal setup script by howtoedittv
# Supports Arch, Debian/Ubuntu, Fedora, openSUSE, Void, and Gentoo.
# Installs core CLI tools, restores your dotfiles, and sets up Oh My Posh.

set -e

REPO_DIR="$HOME/mydots-freebsd"
OLD_DIR="$HOME/oldstuff"
ehco "if you have any errors with the pacakges installing it might require some manual patching based on the sepcic packages names in your distro"

if command -v pacman &>/dev/null; then
    echo "Detected Arch-based system."
    sudo pacman -Sy --needed --noconfirm eza zoxide fzf bat git wget thefuck tldr gedit neofetch curl unzip make gcc gmake gawk

elif command -v apt &>/dev/null; then
    echo "Detected Debian/Ubuntu-based system."
    sudo apt update
    sudo apt install -y eza zoxide fzf bat git wget thefuck tldr gedit neofetch curl unzip make gcc gmake gawk

elif command -v dnf &>/dev/null; then
    echo "Detected Fedora-based system."
    sudo dnf install -y eza zoxide fzf bat git wget thefuck tldr gedit neofetch curl unzip make gcc gmake gawk

elif command -v zypper &>/dev/null; then
    echo "Detected openSUSE-based system."
    sudo zypper refresh
    sudo zypper install -y eza zoxide fzf bat git wget thefuck tldr gedit neofetch curl unzip make gcc gmake gawk

elif command -v xbps-install &>/dev/null; then
    echo "Detected Void Linux."
    sudo xbps-install -Sy eza zoxide fzf bat git wget thefuck tldr gedit neofetch curl unzip make gcc gmake gawk

elif command -v emerge &>/dev/null; then
    echo "Detected Gentoo."
    sudo emerge -aq eza zoxide fzf bat git wget thefuck tldr gedit neofetch curl unzip make gcc gmake gawk

elif command -v pkg &>/dev/null; then
    echo "Detected bsd based distro."
    sudo pkg install eza zoxide fzf bat git wget thefuck tldr gedit neofetch curl unzip make gcc gmake gawk

log "Backing up old bashrc..."
mkdir -p "$OLD_DIR"
[ -f ~/.bashrc ] && mv ~/.bashrc "$OLD_DIR/" || true

log "Applying new configs..."
mv ~/mydots-freebsd/bashrc ~/.bashrc
mv ~/mydots-freebsd/startf.sh ~/


# --- ble.sh setup ---
cd ~

log "installing ble.sh "
git clone https://github.com/akinomyoga/ble.sh.git

cd ble.sh

make

cd ~

# --- Oh My Posh setup -
cd ~
log "Installing Oh My Posh âœ¨"
mkdir -p ~/bin
curl -s https://ohmyposh.dev/install.sh | bash -s -- -d ~/bin
sudo cp -r ~/bin/oh-my-posh /usr/bin/
oh-my-posh font install 0xproto || true
mkdir -p ~/Downloads/poshthemes/
cp ~/mydots-freebsd/catppuccin.omp.json ~/Downloads/poshthemes/ 

sleep 3
log "âœ… Setup complete!"
source ~/.bashrc
 

